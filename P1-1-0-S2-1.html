<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í•™ìŠµ ì„±ì¥ ê³¡ì„  ì‹œë®¬ë ˆì´í„° (v9 - ë²„ê·¸ ìˆ˜ì •)</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Google Fonts - Noto Sans KR -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: #111827; /* bg-gray-900 */
        }
        .gradient-text {
            /* Blue to Teal Gradient */
            background: linear-gradient(to right, #38BDF8, #2DD4BF, #34D399); 
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .accordion-content { display: none; overflow: hidden; }
        .chart-container { position: relative; height: 60vh; width: 100%; min-height: 450px; }
        .formula {
            font-family: 'Times New Roman', Times, serif;
            font-size: 1.25rem; color: #D1D5DB; background: #1F2937;
            padding: 1.5rem; border-radius: 0.5rem; overflow-x: auto; border: 1px solid #4B5563;
        }
        input[type="range"] {
            -webkit-appearance: none; appearance: none;
            width: 100%; height: 8px; background: #374151;
            border-radius: 5px; outline: none;
        }
        /* ì‹œë‚˜ë¦¬ì˜¤ 1 ìŠ¬ë¼ì´ë” ì¸ */
        input[type="range"].slider-scenario-1::-webkit-slider-thumb {
            -webkit-appearance: none; appearance: none;
            width: 20px; height: 20px; background: #F9A8D4; /* accent-pink-300 */
            border-radius: 50%; cursor: pointer; transition: background 0.2s;
        }
        input[type="range"].slider-scenario-1::-moz-range-thumb {
            width: 20px; height: 20px; background: #F9A8D4;
            border-radius: 50%; cursor: pointer; border: none;
        }
        /* ì‹œë‚˜ë¦¬ì˜¤ 2 ìŠ¬ë¼ì´ë” ì¸ */
        input[type="range"].slider-scenario-2::-webkit-slider-thumb {
            -webkit-appearance: none; appearance: none;
            width: 20px; height: 20px; background: #2DD4BF; /* accent-teal-500 */
            border-radius: 50%; cursor: pointer; transition: background 0.2s;
        }
        input[type="range"].slider-scenario-2::-moz-range-thumb {
            width: 20px; height: 20px; background: #2DD4BF;
            border-radius: 50%; cursor: pointer; border: none;
        }
        /* ê³ ê¸‰ ì„¤ì • ìŠ¬ë¼ì´ë” ì¸ (ê¸°ë³¸) */
        input[type="range"].slider-shared::-webkit-slider-thumb {
             -webkit-appearance: none; appearance: none;
            width: 20px; height: 20px; background: #9CA3AF; /* gray-400 */
            border-radius: 50%; cursor: pointer; transition: background 0.2s;
        }
        input[type="range"].slider-shared::-moz-range-thumb {
            width: 20px; height: 20px; background: #9CA3AF;
            border-radius: 50%; cursor: pointer; border: none;
        }
    </style>
</head>
<body class="text-gray-200">

    <div class="container mx-auto max-w-7xl px-4 py-16">

        <!-- í—¤ë” -->
        <header class="text-center mb-16">
            <h1 class="text-5xl md:text-6xl font-black mb-6 gradient-text">
                í•™ìŠµ ì„±ì¥ ê³¡ì„  ë¹„êµ ì‹œë®¬ë ˆì´í„°
            </h1>
            <p class="text-2xl md:text-3xl font-bold text-gray-100">
                (Python ë¡œì§ ê¸°ë°˜ v9)
            </p>
        </header>

        <!-- ì‹œë®¬ë ˆì´ì…˜ ë©”ì¸ (ê·¸ë¦¬ë“œ) -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">

            <!-- 1. ì»¨íŠ¸ë¡¤ íŒ¨ë„ (L) -->
            <div class="lg:col-span-1 bg-gray-800 p-6 rounded-2xl shadow-xl border border-gray-700 h-fit">
                
                <!-- ì‹œë‚˜ë¦¬ì˜¤ 1 -->
                <h2 class="text-2xl font-bold text-pink-300 mb-6 pb-3 border-b border-gray-600">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 inline-block mr-2" viewBox="0 0 20 20" fill="currentColor"><path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z" /><path fill-rule="evenodd" d="M4 5a2 2 0 012-2h8a2 2 0 012 2v10a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 00-1 1v1a1 1 0 102 0v-1a1 1 0 00-1-1zm-1 4a1 1 0 100 2h2a1 1 0 100-2H6zm3 0a1 1 0 100 2h2a1 1 0 100-2H9zm3 0a1 1 0 100 2h1a1 1 0 100-2h-1zm-1-4a1 1 0 100 2h2a1 1 0 100-2h-2z" clip-rule="evenodd" /></svg>
                    ì‹œë‚˜ë¦¬ì˜¤ 1 (í˜„ì¬)
                </h2>
                <div class="space-y-6">
                    <div>
                        <label for="param-total_time_1" class="flex justify-between items-center text-sm font-medium text-gray-300">
                            <span>ì´ í•™ìŠµ ì‹œê°„ (T_d)</span>
                            <span id="val-total_time_1" class="font-bold text-pink-300 text-base">4.0 ì‹œê°„</span>
                        </label>
                        <input type="range" id="param-total_time_1" min="0" max="16" value="4.0" step="0.5" class="w-full mt-2 slider-scenario-1">
                    </div>
                    <div>
                        <label for="param-focus_level_1" class="flex justify-between items-center text-sm font-medium text-gray-300">
                            <span>í•™ìŠµ ëª°ì…ë„ (F_p)</span>
                            <span id="val-focus_level_1" class="font-bold text-pink-300 text-base">70 %</span>
                        </label>
                        <input type="range" id="param-focus_level_1" min="0" max="1" value="0.70" step="0.01" class="w-full mt-2 slider-scenario-1">
                    </div>
                    <div>
                        <label for="param-continuous_time_1" class="flex justify-between items-center text-sm font-medium text-gray-300">
                            <span>ìµœëŒ€ ì—°ì† í•™ìŠµ ì‹œê°„ (T_c)</span>
                            <span id="val-continuous_time_1" class="font-bold text-pink-300 text-base">1.0 ì‹œê°„</span>
                        </label>
                        <input type="range" id="param-continuous_time_1" min="0" max="4" value="1.0" step="0.1" class="w-full mt-2 slider-scenario-1">
                    </div>
                </div>

                <!-- ì‹œë‚˜ë¦¬ì˜¤ 2 -->
                <h2 class="text-2xl font-bold text-teal-300 mt-10 mb-6 pb-3 border-b border-gray-600">
                     <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 inline-block mr-2" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5 2a3 3 0 00-3 3v10a3 3 0 003 3h10a3 3 0 003-3V5a3 3 0 00-3-3H5zm2.5 4a.5.5 0 000 1h3a.5.5 0 000-1h-3zM8 9a.5.5 0 000 1h3a.5.5 0 000-1H8zM7 13.5a.5.5 0 01.5-.5h5a.5.5 0 010 1h-5a.5.5 0 01-.5-.5z" clip-rule="evenodd" /></svg>
                    ì‹œë‚˜ë¦¬ì˜¤ 2 (ê°œì„ )
                </h2>
                 <div class="space-y-6">
                    <div>
                        <label for="param-total_time_2" class="flex justify-between items-center text-sm font-medium text-gray-300">
                            <span>ì´ í•™ìŠµ ì‹œê°„ (T_d)</span>
                            <span id="val-total_time_2" class="font-bold text-teal-300 text-base">12.0 ì‹œê°„</span>
                        </label>
                        <input type="range" id="param-total_time_2" min="0" max="16" value="12.0" step="0.5" class="w-full mt-2 slider-scenario-2">
                    </div>
                    <div>
                        <label for="param-focus_level_2" class="flex justify-between items-center text-sm font-medium text-gray-300">
                            <span>í•™ìŠµ ëª°ì…ë„ (F_p)</span>
                            <span id="val-focus_level_2" class="font-bold text-teal-300 text-base">95 %</span>
                        </label>
                        <input type="range" id="param-focus_level_2" min="0" max="1" value="0.95" step="0.01" class="w-full mt-2 slider-scenario-2">
                    </div>
                    <div>
                        <label for="param-continuous_time_2" class="flex justify-between items-center text-sm font-medium text-gray-300">
                            <span>ìµœëŒ€ ì—°ì† í•™ìŠµ ì‹œê°„ (T_c)</span>
                            <span id="val-continuous_time_2" class="font-bold text-teal-300 text-base">2.8 ì‹œê°„</span>
                        </label>
                        <input type="range" id="param-continuous_time_2" min="0" max="4" value="2.8" step="0.1" class="w-full mt-2 slider-scenario-2">
                    </div>
                </div>

                <!-- [ê³µí†µ] ê³ ê¸‰ ì„¤ì • -->
                <div class="mt-10 pt-6 border-t border-gray-600">
                    <h3 class="text-xl font-bold text-white mb-3">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 inline-block mr-2" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M11.49 3.17c-.38-1.56-2.6-1.56-2.98 0a1.532 1.532 0 01-2.286.948c-1.372-.836-2.942.734-2.106 2.106.54.886.061 2.042-.947 2.287-1.561.379-1.561 2.6 0 2.978a1.532 1.532 0 01.947 2.287c-.835 1.372.734 2.942 2.106 2.106a1.532 1.532 0 012.287.947c.379 1.561 2.6 1.561 2.978 0a1.532 1.532 0 012.287-.947c1.372.835 2.942-.734 2.106-2.106a1.532 1.532 0 01-.947-2.287c1.561-.379 1.561-2.6 0-2.978a1.532 1.532 0 01.947-2.287c.835-1.372-.734-2.942-2.106-2.106A1.532 1.532 0 0111.49 3.17zM10 13a3 3 0 100-6 3 3 0 000 6z" clip-rule="evenodd" /></svg>
                        ê³µí†µ ê³ ê¸‰ ì„¤ì • (ìƒìˆ˜)
                    </h3>
                    <div class="space-y-6">
                         <div>
                            <label for="param-A0" class="flex justify-between items-center text-sm font-medium text-gray-300">
                                <span>ì´ˆê¸° ëŠ¥ë ¥ì¹˜ (Aâ‚€)</span>
                                <span id="val-A0" class="font-bold text-white text-base">1</span>
                            </label>
                            <input type="range" id="param-A0" min="1" max="100" value="1" step="1" class="w-full mt-2 slider-shared">
                        </div>
                        <div>
                            <label for="param-L" class="flex justify-between items-center text-sm font-medium text-gray-300">
                                <span>ìµœëŒ€ ëŠ¥ë ¥ì¹˜ (L)</span>
                                <span id="val-L" class="font-bold text-white text-base">1000</span>
                            </label>
                            <input type="range" id="param-L" min="500" max="2000" value="1000" step="50" class="w-full mt-2 slider-shared">
                        </div>
                        <div>
                            <label for="param-B" class="flex justify-between items-center text-sm font-medium text-gray-300">
                                <span>ê¸°ë³¸ í•™ìŠµ íš¨ìœ¨ (B)</span>
                                <span id="val-B" class="font-bold text-white text-base">0.010</span>
                            </label>
                            <input type="range" id="param-B" min="0.001" max="0.05" value="0.01" step="0.001" class="w-full mt-2 slider-shared">
                        </div>
                        <div>
                            <label for="param-wc" class="flex justify-between items-center text-sm font-medium text-gray-300">
                                <span>ì—°ì† ë³´ë„ˆìŠ¤ ê°€ì¤‘ì¹˜ (w_c)</span>
                                <span id="val-wc" class="font-bold text-white text-base">0.25</span>
                            </label>
                            <input type="range" id="param-wc" min="0" max="1" value="0.25" step="0.01" class="w-full mt-2 slider-shared">
                        </div>
                        <div>
                            <label for="param-Sim_Days" class="flex justify-between items-center text-sm font-medium text-gray-300">
                                <span>ì‹œë®¬ë ˆì´ì…˜ ê¸°ê°„ (Sim_Days)</span>
                                <span id="val-Sim_Days" class="font-bold text-white text-base">365 ì¼</span>
                            </label>
                            <input type="range" id="param-Sim_Days" min="30" max="18250" value="365" step="30" class="w-full mt-2 slider-shared">
                        </div>
                    </div>
                </div>
            </div>

            <!-- 2. ê·¸ë˜í”„ ë° í•´ì„ (R) -->
            <div class="lg:col-span-2 space-y-8">
                <!-- ì°¨íŠ¸ -->
                <div class="bg-gray-800 p-6 rounded-2xl shadow-xl border border-gray-700">
                    <h2 class="text-2xl font-bold text-white mb-4">ğŸ“ˆ ëŠ¥ë ¥ì¹˜(A) ë¹„êµ ì„±ì¥ ê³¡ì„ </h2>
                    <div class="chart-container">
                        <canvas id="growthChart"></canvas>
                    </div>
                </div>
                
                <!-- 1. ì‹œë®¬ë ˆì´ì…˜ ê²°ê³¼ ìš”ì•½ -->
                <div class="bg-gray-800 p-8 rounded-2xl shadow-xl border border-gray-700">
                    <h2 class="text-2xl font-bold text-white mb-6 pb-3 border-b border-gray-600">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 inline-block mr-2" viewBox="0 0 20 20" fill="currentColor"><path d="M10 2a6 6 0 00-6 6v3.586l-1.707 1.707A1 1 0 003 15v4a1 1 0 001 1h12a1 1 0 001-1v-4a1 1 0 00-.293-.707L16 11.586V8a6 6 0 00-6-6zM10 18a3 3 0 01-3-3h6a3 3 0 01-3 3z" /></svg>
                        ì‹œë®¬ë ˆì´ì…˜ ê²°ê³¼ ìš”ì•½
                    </h2>
                    <div id="analysis-text" class="text-lg text-gray-300 leading-relaxed space-y-3">
                        <!-- JSë¡œ ë™ì  ì—…ë°ì´íŠ¸ -->
                    </div>
                </div>

                <!-- 2. ìƒì„¸ ë¹„êµ ì»¨ì„¤íŒ… ë³´ê³ ì„œ -->
                <div class="bg-gray-800 p-8 rounded-2xl shadow-xl border border-gray-700">
                    <h2 class="text-2xl font-bold text-white mb-6 pb-3 border-b border-gray-600">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 inline-block mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                          <path stroke-linecap="round" stroke-linejoin="round" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                        </svg>
                        ìƒì„¸ ë¹„êµ ì»¨ì„¤íŒ… ë³´ê³ ì„œ
                    </h2>
                    <div id="comparative-consulting-report" class="text-base text-gray-300 leading-relaxed space-y-4">
                        <!-- JSë¡œ ë™ì  ì—…ë°ì´íŠ¸ -->
                    </div>
                </div>

                <!-- 3. 'ì‹œë‚˜ë¦¬ì˜¤ 2'ë¥¼ ìœ„í•œ AI í•™ìŠµ ë„ìš°ë¯¸ í™œìš©ë²• -->
                <div class="bg-gray-800 p-8 rounded-2xl shadow-xl border border-gray-700">
                    <h2 class="text-2xl font-bold text-white mb-6 pb-3 border-b border-gray-600">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 inline-block mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                          <path stroke-linecap="round" stroke-linejoin="round" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707m12.728 0l-.707-.707M12 21v-1m-4-4H7M17 17h-1" />
                        </svg>
                        'ì‹œë‚˜ë¦¬ì˜¤ 2'ë¥¼ ìœ„í•œ AI í•™ìŠµ ë„ìš°ë¯¸ í™œìš©ë²•
                    </h2>
                    <div id="variable-ai-guide" class="text-gray-300 leading-relaxed space-y-6">
                        <!-- JSë¡œ ë™ì  ì—…ë°ì´íŠ¸ (ì‹œë‚˜ë¦¬ì˜¤ 2 ê¸°ì¤€) -->
                    </div>
                </div>

            </div>
        </div>

        <!-- ì‹œë®¬ë ˆì´ì…˜ ì‘ë™ ì›ë¦¬ (ì•„ì½”ë””ì–¸) -->
        <section class="mt-24">
            <h2 class="text-4xl font-extrabold text-center mb-12 gradient-text">
                ì‹œë®¬ë ˆì´ì…˜ ì‘ë™ ì›ë¦¬
            </h2>
            <div class="max-w-4xl mx-auto space-y-4">
                
                <!-- ì•„ì½”ë””ì–¸ 1: ì¼ì¼ ì„±ì¥ë¥ (k) ê³„ì‚° -->
                <div class="accordion-item bg-gray-800 rounded-lg shadow-lg border border-gray-700">
                    <button class="accordion-button w-full flex justify-between items-center text-left p-6">
                        <span class="text-xl font-semibold text-gray-100">1. ì¼ì¼ ì„±ì¥ë¥  (k) ê³„ì‚°</span>
                        <svg class="w-6 h-6 text-gray-400 transform transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                    </button>
                    <div class="accordion-content px-6 pb-6 text-lg">
                        <p class="text-gray-300 leading-relaxed mb-4">
                            ë§¤ì¼ì˜ 'ì„±ì¥ë¥ (k)'ì€ ì´ í•™ìŠµ ì‹œê°„, ëª°ì…ë„, ì—°ì† í•™ìŠµ ì‹œê°„ì„ ê¸°ë°˜ìœ¼ë¡œ ê³„ì‚°ë©ë‹ˆë‹¤.
                        </p>
                        <div class="formula">
                            $E_{eff} = T_d \cdot F_p$ (ìœ íš¨ í•™ìŠµ ì‹œê°„)
                            <br>
                            $C_{bonus} = 1 + (w_c \cdot T_c)$ (ì—°ì† í•™ìŠµ ë³´ë„ˆìŠ¤)
                            <br>
                            $k = B \cdot E_{eff} \cdot C_{bonus}$
                        </div>
                    </div>
                </div>
                
                <!-- ì•„ì½”ë””ì–¸ 2: ë¡œì§€ìŠ¤í‹± ì„±ì¥ ëª¨ë¸ -->
                <div class="accordion-item bg-gray-800 rounded-lg shadow-lg border border-gray-700">
                    <button class="accordion-button w-full flex justify-between items-center text-left p-6">
                        <span class="text-xl font-semibold text-gray-100">2. ë¡œì§€ìŠ¤í‹± ì„±ì¥ ëª¨ë¸ (ì´ì‚°í˜•)</span>
                        <svg class="w-6 h-6 text-gray-400 transform transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                    </button>
                    <div class="accordion-content px-6 pb-6 text-lg">
                        <p class="text-gray-300 leading-relaxed mb-4">
                            ì¼ì¼ 'ëŠ¥ë ¥ì¹˜ ë³€í™”ëŸ‰($\Delta A$)'ì€ ì–´ì œì˜ ëŠ¥ë ¥ì¹˜($A_{t-1}$)ì™€ ì„±ì¥ í•œê³„($L$)ì— ì˜í•´ ê²°ì •ë©ë‹ˆë‹¤.
                        </p>
                        <div class="formula">
                            $\Delta A = k \cdot A_{t-1} \cdot (1 - \frac{A_{t-1}}{L})$
                        </div>
                    </div>
                </div>

                <!-- ì•„ì½”ë””ì–¸ 3: ì‹œë®¬ë ˆì´ì…˜ ë£¨í”„ -->
                <div class="accordion-item bg-gray-800 rounded-lg shadow-lg border border-gray-700">
                    <button class="accordion-button w-full flex justify-between items-center text-left p-6">
                        <span class="text-xl font-semibold text-gray-100">3. ì‹œë®¬ë ˆì´ì…˜ ë£¨í”„</span>
                        <svg class="w-6 h-6 text-gray-400 transform transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                    </button>
                    <div class="accordion-content px-6 pb-6 text-lg">
                        <p class="text-gray-300 leading-relaxed mb-4">
                            ì‹œë®¬ë ˆì´ì…˜ì€ $Sim\_Days$ (ì˜ˆ: 365ì¼) ë™ì•ˆ ë§¤ì¼ ë‹¤ìŒ ê³„ì‚°ì„ ë°˜ë³µí•©ë‹ˆë‹¤.
                        </p>
                        <div class="formula">
                            $A_t = A_{t-1} + \Delta A$
                        </div>
                    </div>
                </div>

            </div>
        </section>

    </div>

    <script>
        document.addEventListener('DOMContentLoaded', initializeApp);

        let growthChart; 
        const inputs = {};
        const values = {};
        
        const paramIds_1 = ['total_time_1', 'focus_level_1', 'continuous_time_1'];
        const paramIds_2 = ['total_time_2', 'focus_level_2', 'continuous_time_2'];
        const paramIds_shared = ['A0', 'L', 'B', 'wc', 'Sim_Days'];
        const allParamIds = [...paramIds_1, ...paramIds_2, ...paramIds_shared];

        // --- 1. ì‹œë®¬ë ˆì´ì…˜ í•µì‹¬ ë¡œì§ ---

        function calculateKDaily(params) {
            const { total_time, focus_level, continuous_time, B, wc } = params;
            const effective_hours = total_time * focus_level;
            const continuity_bonus = 1 + (wc * continuous_time);
            return B * effective_hours * continuity_bonus;
        }

        function runSimulation(params, k_scenario) {
            const { A0, L, Sim_Days } = params;
            let ability_history = [A0];
            let days = [0];
            let current_ability = A0;

            for (let day = 1; day <= Sim_Days; day++) {
                let growth = 0;
                if (current_ability > 0 && current_ability < L) {
                    const logistic_factor = current_ability * (1 - (current_ability / L));
                    growth = k_scenario * logistic_factor;
                }
                current_ability += growth;
                current_ability = Math.min(Math.max(current_ability, 0), L);
                ability_history.push(current_ability);
                days.push(day);
            }
            return { days, ability_history };
        }

        // --- 2. UI ì—…ë°ì´íŠ¸ í•¨ìˆ˜ ---

        function updateChart(data_A, data_B) {
            const chartCanvas = document.getElementById('growthChart')?.getContext('2d');
            if (!chartCanvas) return;

            const L = parseFloat(inputs.L.value);
            const line_50 = new Array(data_A.days.length).fill(L * 0.5);
            const line_90 = new Array(data_A.days.length).fill(L * 0.9);
            const Sim_Days = parseFloat(inputs.Sim_Days.value);
            const labelStep = Math.max(30, Math.ceil(Sim_Days / 12 / 30) * 30); 

            try {
                if (growthChart) {
                    growthChart.data.labels = data_A.days;
                    growthChart.data.datasets[0].data = data_A.ability_history;
                    growthChart.data.datasets[1].data = data_B.ability_history;
                    growthChart.data.datasets[2].data = line_50;
                    growthChart.data.datasets[3].data = line_90;
                    growthChart.options.scales.y.max = L; 
                    growthChart.options.scales.x.ticks.callback = function(value, index, values) {
                        return (index % labelStep === 0) ? `${data_A.days[index]}ì¼` : null;
                    };
                    growthChart.update();
                } else {
                    growthChart = new Chart(chartCanvas, {
                        type: 'line',
                        data: {
                            labels: data_A.days,
                            datasets: [
                                {
                                    label: 'ì‹œë‚˜ë¦¬ì˜¤ 1 (í˜„ì¬)',
                                    data: data_A.ability_history,
                                    borderColor: '#F9A8D4', // Pink
                                    backgroundColor: '#F9A8D430',
                                    borderWidth: 2.5,
                                    fill: false,
                                    tension: 0.1
                                },
                                {
                                    label: 'ì‹œë‚˜ë¦¬ì˜¤ 2 (ê°œì„ )',
                                    data: data_B.ability_history,
                                    borderColor: '#2DD4BF', // Teal
                                    backgroundColor: '#2DD4BF30',
                                    borderWidth: 3.5,
                                    fill: true,
                                    tension: 0.1
                                },
                                {
                                    label: '50% ë‹¬ì„±ì„ ',
                                    data: line_50,
                                    borderColor: '#3B82F6', // Blue-500
                                    borderWidth: 1.5,
                                    borderDash: [5, 5], 
                                    fill: false,
                                    pointRadius: 0
                                },
                                {
                                    label: '90% ë‹¬ì„±ì„ ',
                                    data: line_90,
                                    borderColor: '#EF4444', // Red-500
                                    borderWidth: 1.5,
                                    borderDash: [5, 5], 
                                    fill: false,
                                    pointRadius: 0
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: { position: 'top', labels: { color: '#E5E7EB', font: { size: 14 } } },
                                tooltip: { mode: 'index', intersect: false, callbacks: { 
                                    title: (tooltipItems) => `${tooltipItems[0].label} ì¼ì°¨`,
                                    label: (tooltipItem) => `${tooltipItem.dataset.label || ''}: ${parseFloat(tooltipItem.raw).toFixed(1)}`
                                } }
                            },
                            scales: {
                                x: {
                                    title: { display: true, text: 'ì‹œê°„ (ì¼)', color: '#9CA3AF' },
                                    ticks: {
                                        color: '#9CA3AF',
                                        callback: function(value, index, values) {
                                            return (index % labelStep === 0) ? `${data_A.days[index]}ì¼` : null;
                                        },
                                        maxRotation: 0,
                                        autoSkip: false
                                    },
                                    grid: { color: '#374151' }
                                },
                                y: {
                                    title: { display: true, text: 'ëŠ¥ë ¥ì¹˜ (A)', color: '#9CA3AF' },
                                    ticks: { color: '#9CA3AF' },
                                    grid: { color: '#374151' },
                                    min: 0,
                                    max: L
                                }
                            },
                            elements: { point: { radius: 0, hitRadius: 10, hoverRadius: 5 } }
                        }
                    });
                }
            } catch (error) {
                console.error("[Chart Error]", error);
            }
        }

        function updateAnalysis(data_A, data_B, params_shared, k_value_A, k_value_B) {
            const analysisText = document.getElementById('analysis-text');
            if (!analysisText) return;
            
            const { L, Sim_Days } = params_shared;
            const L_50 = L * 0.5;
            const L_90 = L * 0.9;

            const day_50_A = data_A.ability_history.findIndex(val => val >= L_50);
            const day_90_A = data_A.ability_history.findIndex(val => val >= L_90);
            const day_50_A_text = (day_50_A > 0) ? `ì•½ ${day_50_A}ì¼` : `${Sim_Days}ì¼ ë‚´ ë„ë‹¬ ëª»í•¨`;
            const day_90_A_text = (day_90_A > 0) ? `ì•½ ${day_90_A}ì¼` : `${Sim_Days}ì¼ ë‚´ ë„ë‹¬ ëª»í•¨`;

            const day_50_B = data_B.ability_history.findIndex(val => val >= L_50);
            const day_90_B = data_B.ability_history.findIndex(val => val >= L_90);
            const day_50_B_text = (day_50_B > 0) ? `ì•½ ${day_50_B}ì¼` : `${Sim_Days}ì¼ ë‚´ ë„ë‹¬ ëª»í•¨`;
            const day_90_B_text = (day_90_B > 0) ? `ì•½ ${day_90_B}ì¼` : `${Sim_Days}ì¼ ë‚´ ë„ë‹¬ ëª»í•¨`;

            analysisText.innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="p-4 bg-gray-900 rounded-lg">
                        <h4 class="text-lg font-semibold text-pink-300">ì‹œë‚˜ë¦¬ì˜¤ 1 (í˜„ì¬)</h4>
                        <p class="mt-2"><strong>ì„±ì¥ë¥  (k)</strong>: <span class="font-bold text-xl">${k_value_A.toFixed(4)}</span></p>
                        <p class="mt-1 text-sm"><strong>50% (A=${L_50.toFixed(0)}) ë„ë‹¬:</strong> ${day_50_A_text}</p>
                        <p class="mt-1 text-sm"><strong>90% (A=${L_90.toFixed(0)}) ë„ë‹¬:</strong> <span class="${day_90_A > 0 ? '' : 'text-red-400'}">${day_90_A_text}</span></p>
                    </div>
                    <div class="p-4 bg-gray-900 rounded-lg">
                        <h4 class="text-lg font-semibold text-teal-300">ì‹œë‚˜ë¦¬ì˜¤ 2 (ê°œì„ )</h4>
                        <p class="mt-2"><strong>ì„±ì¥ë¥  (k)</strong>: <span class="font-bold text-xl">${k_value_B.toFixed(4)}</span></p>
                        <p class="mt-1 text-sm"><strong>50% (A=${L_50.toFixed(0)}) ë„ë‹¬:</strong> ${day_50_B_text}</p>
                        <p class="mt-1 text-sm"><strong>90% (A=${L_90.toFixed(0)}) ë„ë‹¬:</strong> <span class="${day_90_B > 0 ? 'text-white' : 'text-red-400'}">${day_90_B_text}</span></p>
                    </div>
                </div>
            `;
        }

        /**
         * [ë²„ê·¸ ìˆ˜ì •] ìƒì„¸ ë¹„êµ ì»¨ì„¤íŒ… ë³´ê³ ì„œ
         * v8ì˜ ë²„ê·¸: function(data_A, data_B, params, k_value_A, k_value_B)
         * v9ì˜ ìˆ˜ì •: function(data_A, data_B, params_A, params_B, k_value_A, k_value_B)
         */
        function updateComparativeReport(data_A, data_B, params_A, params_B, k_value_A, k_value_B) {
            const reportDiv = document.getElementById('comparative-consulting-report');
            if (!reportDiv) return;

            // [ë²„ê·¸ ìˆ˜ì •] ê³µí†µ íŒŒë¼ë¯¸í„°ëŠ” params_A ë˜ëŠ” params_Bì—ì„œ ê°€ì ¸ì˜´
            const { L, Sim_Days } = params_A; 
            
            const final_A = data_A.ability_history[data_A.ability_history.length - 1];
            const final_B = data_B.ability_history[data_B.ability_history.length - 1];
            const k_diff_percent = (k_value_A > 0) ? ((k_value_B / k_value_A) - 1) * 100 : (k_value_B > 0 ? 1000 : 0);
            
            const day_90_A = data_A.ability_history.findIndex(val => val >= L * 0.9);
            const day_90_B = data_B.ability_history.findIndex(val => val >= L * 0.9);

            // 1. kê°’ ë¹„êµ
            let k_analysis = `ì‹œë‚˜ë¦¬ì˜¤ 2ì˜ ì„±ì¥ë¥ (k=${k_value_B.toFixed(4)})ì€ 1(${k_value_A.toFixed(4)}) ëŒ€ë¹„ <strong class="text-teal-300">${k_diff_percent.toFixed(0)}%</strong> ë” ë†’ìŠµë‹ˆë‹¤. ì´ê²ƒì´ ëª¨ë“  ì°¨ì´ë¥¼ ë§Œë“œëŠ” í•µì‹¬ì…ë‹ˆë‹¤.`;
            if (k_value_B < k_value_A) {
                 k_analysis = `ì‹œë‚˜ë¦¬ì˜¤ 2ì˜ ì„±ì¥ë¥ (k=${k_value_B.toFixed(4)})ì€ 1(${k_value_A.toFixed(4)}) ëŒ€ë¹„ <strong class="text-red-400">${Math.abs(k_diff_percent).toFixed(0)}%</strong> ë” ë‚®ìŠµë‹ˆë‹¤. ê°œì„ ì•ˆì´ ì˜¤íˆë ¤ ë¹„íš¨ìœ¨ì ì…ë‹ˆë‹¤.`;
            } else if (k_diff_percent < 10 && k_diff_percent > -10) {
                 k_analysis = `ì‹œë‚˜ë¦¬ì˜¤ 2ì˜ ì„±ì¥ë¥ (k=${k_value_B.toFixed(4)})ì€ 1(${k_value_A.toFixed(4)})ê³¼ <strong class="text-yellow-300">ê±°ì˜ ì°¨ì´ê°€ ì—†ìŠµë‹ˆë‹¤.</strong> ê°œì„ ì•ˆì˜ ë³€ìˆ˜ ê°’ì„ ë” ê³µê²©ì ìœ¼ë¡œ ìˆ˜ì •í•´ë³´ì„¸ìš”.`;
            }

            // 2. í•µì‹¬ ë™ì¸
            // [ë²„ê·¸ ìˆ˜ì •] params_Aì™€ params_Bì˜ ì†ì„±ì„ ì§ì ‘ ë¹„êµ
            const diff_T = params_B.total_time - params_A.total_time;
            const diff_F = params_B.focus_level - params_A.focus_level;
            const diff_C = params_B.continuous_time - params_A.continuous_time;
            
            let driver_analysis = "";
            if (k_diff_percent > 10) {
                 driver_analysis = `ì´ ì„±ê³¼ë¥¼ ì´ëˆ í•µì‹¬ ë™ì¸ì€ <strong class="text-white">${Math.abs(diff_T).toFixed(1)}ì‹œê°„ ì¦ê°€í•œ ì´ í•™ìŠµ ì‹œê°„</strong>ê³¼ <strong class="text-white">${(Math.abs(diff_F)*100).toFixed(0)}%p ì¦ê°€í•œ ëª°ì…ë„</strong>ì…ë‹ˆë‹¤. 'ì–‘'ê³¼ 'ì§ˆ' ëª¨ë‘ë¥¼ ì¡ì•˜ìŠµë‹ˆë‹¤.`;
            } else if (k_diff_percent < -10) {
                driver_analysis = `kê°’ì´ í•˜ë½í•œ ì£¼ëœ ì›ì¸ì€ <strong class="text-red-400">í•™ìŠµ ì‹œê°„ ê°ì†Œ(${diff_T.toFixed(1)}h)</strong> ë° <strong class="text-red-400">ëª°ì…ë„ í•˜ë½(${(diff_F*100).toFixed(0)}%p)</strong>ì…ë‹ˆë‹¤.`;
            } else {
                driver_analysis = "ë‘ ì‹œë‚˜ë¦¬ì˜¤ ê°„ì˜ kê°’ ì°¨ì´ê°€ ë¯¸ë¯¸í•©ë‹ˆë‹¤. ë” ê·¹ì ì¸ ë³€í™”ë¥¼ ìœ„í•´ ë³€ìˆ˜ ê°’ì„ ì¡°ì •í•´ë³´ì„¸ìš”.";
            }

            // 3. ëª©í‘œ ë‹¬ì„± ì†ë„
            let goal_analysis = "";
            if (day_90_A > 0 && day_90_B > 0) {
                goal_analysis = `ì „ë¬¸ê°€ ìˆ˜ì¤€(90%) ë„ë‹¬ ì†ë„ê°€ <strong class="text-white">${day_90_A}ì¼</strong>ì—ì„œ <strong class="text-teal-300">${day_90_B}ì¼</strong>ë¡œ <strong class="text-teal-300">${day_90_A - day_90_B}ì¼</strong> ë‹¨ì¶•ë˜ì—ˆìŠµë‹ˆë‹¤.`;
            } else if (day_90_A <= 0 && day_90_B > 0) {
                goal_analysis = `ì‹œë‚˜ë¦¬ì˜¤ 1ì€ ${Sim_Days}ì¼ ë‚´ 90% ë„ë‹¬ì´ ë¶ˆê°€ëŠ¥í–ˆì§€ë§Œ, ì‹œë‚˜ë¦¬ì˜¤ 2ëŠ” <strong class="text-teal-300">${day_90_B}ì¼</strong> ë§Œì— 90% ë„ë‹¬ì— ì„±ê³µí–ˆìŠµë‹ˆë‹¤. <strong class="text-teal-300">'ë¶ˆê°€ëŠ¥'ì´ 'ê°€ëŠ¥'ìœ¼ë¡œ ë°”ë€Œì—ˆìŠµë‹ˆë‹¤.</strong>`;
            } else if (day_90_A > 0 && day_90_B <= 0) {
                goal_analysis = `ì˜¤íˆë ¤ ì‹œë‚˜ë¦¬ì˜¤ 2ì—ì„œ 90% ë„ë‹¬ì´ <strong class="text-red-400">ë¶ˆê°€ëŠ¥</strong>í•´ì¡ŒìŠµë‹ˆë‹¤. ì‹œë‚˜ë¦¬ì˜¤ 1ì˜ ì „ëµì„ ìœ ì§€í•´ì•¼ í•©ë‹ˆë‹¤.`;
            } else {
                goal_analysis = `ë‘ ì‹œë‚˜ë¦¬ì˜¤ ëª¨ë‘ ${Sim_Days}ì¼ ë‚´ 90% ë„ë‹¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë” ë†’ì€ kê°’ ë˜ëŠ” ë” ê¸´ ì‹œë®¬ë ˆì´ì…˜ ê¸°ê°„ì´ í•„ìš”í•©ë‹ˆë‹¤.`;
            }

            // 4. ìµœì¢… ì„±ì¥ë„
            let final_analysis = `${Sim_Days}ì¼ í›„, ì‹œë‚˜ë¦¬ì˜¤ 2ì˜ ìµœì¢… ëŠ¥ë ¥ì¹˜(<strong class="text-teal-300">${final_B.toFixed(0)}</strong>)ëŠ” 1(<strong class="text-pink-300">${final_A.toFixed(0)}</strong>)ë³´ë‹¤ <strong class="text-white">${(final_B - final_A).toFixed(0)} í¬ì¸íŠ¸</strong> ë” ë†’ìŠµë‹ˆë‹¤. ì´ ì°¨ì´ëŠ” ì‹œê°„ì´ ì§€ë‚ ìˆ˜ë¡ ê¸°í•˜ê¸‰ìˆ˜ì ìœ¼ë¡œ ë²Œì–´ì§ˆ ê²ƒì…ë‹ˆë‹¤.`;
            if (final_B < final_A) {
                final_analysis = `${Sim_Days}ì¼ í›„, ì‹œë‚˜ë¦¬ì˜¤ 2ì˜ ìµœì¢… ëŠ¥ë ¥ì¹˜(<strong class="text-teal-300">${final_B.toFixed(0)}</strong>)ëŠ” 1(<strong class="text-pink-300">${final_A.toFixed(0)}</strong>)ë³´ë‹¤ <strong class="text-red-400">${(final_A - final_B).toFixed(0)} í¬ì¸íŠ¸</strong> ë” ë‚®ìŠµë‹ˆë‹¤.`;
            }

            reportDiv.innerHTML = `
                <div class="mt-4">
                    <h3 class="text-lg font-semibold text-white">1. ì„±ì¥ë¥ (k) ë¹„êµ</h3>
                    <p>${k_analysis}</p>
                </div>
                <div class="mt-4">
                    <h3 class="text-lg font-semibold text-white">2. í•µì‹¬ ë³€í™” ë™ì¸</h3>
                    <p>${driver_analysis}</p>
                </div>
                <div class="mt-4">
                    <h3 class="text-lg font-semibold text-white">3. ëª©í‘œ ë‹¬ì„± ì†ë„ ë¹„êµ (90% ê¸°ì¤€)</h3>
                    <p>${goal_analysis}</p>
                </div>
                <div class="mt-4">
                    <h3 class="text-lg font-semibold text-white">4. ìµœì¢… ëŠ¥ë ¥ì¹˜ ë° ì „ëµ ì œì–¸</h3>
                    <p>${final_analysis}</p>
                    <p class="mt-2"><strong>[ìµœì¢… ì œì–¸]</strong>: ${k_diff_percent > 10 ? "ì‹œë®¬ë ˆì´ì…˜ ê²°ê³¼ê°€ ëª…í™•í•˜ê²Œ ë³´ì—¬ì£¼ë“¯, 'ì‹œë‚˜ë¦¬ì˜¤ 2'ì˜ í•™ìŠµ ìŠµê´€ì„ ì¦‰ì‹œ ë„ì…í•˜ëŠ” ê²ƒì´ ì¥ê¸°ì ìœ¼ë¡œ ë§‰ëŒ€í•œ ì´ìµì„ ê°€ì ¸ì˜µë‹ˆë‹¤. ì•„ë˜ì˜ AI í™œìš©ë²•ì„ ì°¸ê³ í•˜ì—¬ 'ì‹œë‚˜ë¦¬ì˜¤ 2'ë¥¼ í˜„ì‹¤ë¡œ ë§Œë“œì‹­ì‹œì˜¤." : "í˜„ì¬ 'ì‹œë‚˜ë¦¬ì˜¤ 2'ì˜ ì„¤ì •ì´ 'ì‹œë‚˜ë¦¬ì˜¤ 1'ë³´ë‹¤ ë¹„íš¨ìœ¨ì ì´ê±°ë‚˜ ì°¨ì´ê°€ ë¯¸ë¯¸í•©ë‹ˆë‹¤. 'ê°œì„ ' ì‹œë‚˜ë¦¬ì˜¤ì˜ T_d, F_p ê°’ì„ ë” ë†’ê²Œ ì„¤ì •í•˜ì—¬ kê°’ì˜ ê·¹ì ì¸ ì°¨ì´ë¥¼ í™•ì¸í•´ë³´ì‹­ì‹œì˜¤."}</p>
                </div>
            `;
        }

        /**
         * [ë³´ì™„] ë³€ìˆ˜ ê°€ì´ë“œ (ì‹œë‚˜ë¦¬ì˜¤ 2 ê¸°ì¤€, w_c ì¶”ê°€)
         */
        function updateVariableGuide(params_B, k_value_B) {
            const guideDiv = document.getElementById('variable-ai-guide');
            if (!guideDiv) return;

            const { total_time, focus_level, continuous_time, B, wc, L } = params_B;

            guideDiv.innerHTML = `
                <div class="p-4 bg-gray-900 rounded-lg">
                    <h4 class="text-lg font-semibold text-sky-300">1. ì´ í•™ìŠµ ì‹œê°„ (T_d) <span class="text-sm font-normal text-white">(ëª©í‘œ: ${total_time.toFixed(1)} ì‹œê°„)</span></h4>
                    <p class="text-sm mt-1"><strong>AI í™œìš©ë²•:</strong> AIì—ê²Œ "ë‚˜ì˜ í•˜ë£¨ ì¼ê³¼í‘œ(ì˜ˆ: ë¯¸íŒ…, ì‹ì‚¬ ì‹œê°„)ë¥¼ ì£¼ê³ , ëª©í‘œ ${total_time.toFixed(1)}ì‹œê°„ì˜ í•™ìŠµ ì‹œê°„ì„ í™•ë³´í•  ìˆ˜ ìˆëŠ” ìµœì ì˜ ìŠ¤ì¼€ì¤„ì„ 3ê°€ì§€ ì•ˆìœ¼ë¡œ ì œì•ˆí•´ì¤˜"ë¼ê³  ìš”ì²­í•˜ì‹­ì‹œì˜¤.</p>
                </div>
                <div class="p-4 bg-gray-900 rounded-lg">
                    <h4 class="text-lg font-semibold text-sky-300">2. í•™ìŠµ ëª°ì…ë„ (F_p) <span class="text-sm font-normal text-white">(ëª©í‘œ: ${(focus_level * 100).toFixed(0)} %)</span></h4>
                    <p class="text-sm mt-1"><strong>AI í™œìš©ë²•:</strong> 'ë½€ëª¨ë„ë¡œ íƒ€ì´ë¨¸' ì„¸ì…˜(ì˜ˆ: 50ë¶„ í•™ìŠµ, 10ë¶„ íœ´ì‹)ì„ AIì™€ í•¨ê»˜ ì‹œì‘í•˜ì‹­ì‹œì˜¤. AIì—ê²Œ "ë‚´ê°€ [ì£¼ì œ]ë¥¼ í•™ìŠµí•  ë•Œ ëª°ì…ë„ê°€ ë–¨ì–´ì§€ëŠ” ì§•í›„ê°€ ë³´ì´ë©´, ì¦‰ì‹œ ì•Œë ¤ì£¼ê³  ê´€ë ¨ëœ í€´ì¦ˆë¥¼ ë‚´ì¤˜"ë¼ê³  ìš”ì²­í•˜ì—¬ ìƒí˜¸ì‘ìš©ì„ ìœ ì§€í•˜ì‹­ì‹œì˜¤.</p>
                </div>
                <div class="p-4 bg-gray-900 rounded-lg">
                    <h4 class="text-lg font-semibold text-sky-300">3. ìµœëŒ€ ì—°ì† í•™ìŠµ ì‹œê°„ (T_c) <span class="text-sm font-normal text-white">(ëª©í‘œ: ${continuous_time.toFixed(1)} ì‹œê°„)</span></h4>
                    <p class="text-sm mt-1"><strong>AI í™œìš©ë²•:</strong> AIì—ê²Œ "${continuous_time.toFixed(1)}ì‹œê°„ ë¶„ëŸ‰ì˜ [ì£¼ì œ]ì— ëŒ€í•œ ë”¥ë‹¤ì´ë¸Œ í•™ìŠµ ì„¸ì…˜ì„ ì„¤ê³„í•´ì¤˜. ì¤‘ê°„ì— íë¦„ì´ ëŠê¸°ì§€ ì•Šë„ë¡ ê´€ë ¨ ê°œë…ì„ ìˆœì„œëŒ€ë¡œ ë°°ì—´í•˜ê³ , ë§ˆì§€ë§‰ 10ë¶„ì€ ë³µìŠµ í€´ì¦ˆë¡œ êµ¬ì„±í•´ì¤˜"ë¼ê³  ìš”ì²­í•˜ì‹­ì‹œì˜¤.</p>
                </div>
                <div class="p-4 bg-gray-900 rounded-lg">
                    <h4 class="text-lg font-semibold text-white">4. ê¸°ë³¸ í•™ìŠµ íš¨ìœ¨ (B) <span class="text-sm font-normal text-white">(í˜„ì¬: ${B.toFixed(3)})</span></h4>
                    <p class="text-sm mt-1"><strong>AI í™œìš©ë²• (í•µì‹¬):</strong> Bê°’ì„ ê·¹ëŒ€í™”í•˜ëŠ” ê²ƒì´ AI í™œìš©ì˜ í•µì‹¬ì…ë‹ˆë‹¤. AIì—ê²Œ "ë‚´ê°€ [ì£¼ì œ]ë¥¼ L=${L.toFixed(0)} ìˆ˜ì¤€ê¹Œì§€ ë°°ìš°ë ¤ í•´. ê°€ì¥ íš¨ìœ¨ì ì¸(Bê°€ ë†’ì€) í•™ìŠµ ë¡œë“œë§µì„ ì§œì¤˜", "ì´ ë³µì¡í•œ ê°œë…ì„ 'íŒŒì¸ë§Œ ê¸°ë²•'ìœ¼ë¡œ 10ì‚´ ì•„ì´ë„ ì´í•´í•˜ê²Œ ì„¤ëª…í•´ì¤˜", "ê´€ë ¨ëœ 'ë©”íƒ€ì¸ì§€' ì§ˆë¬¸ 5ê°œë§Œ í•´ì¤˜"ë¼ê³  ìš”ì²­í•˜ì—¬ í•™ìŠµ íš¨ìœ¨ ìì²´ë¥¼ ê·¹ëŒ€í™”í•˜ì‹­ì‹œì˜¤.</p>
                </div>
                <!-- [ë³´ì™„] ëˆ„ë½ë˜ì—ˆë˜ w_c í•­ëª© ì¶”ê°€ -->
                 <div class="p-4 bg-gray-900 rounded-lg">
                    <h4 class="text-lg font-semibold text-white">5. ì—°ì† ë³´ë„ˆìŠ¤ ê°€ì¤‘ì¹˜ (w_c) <span class="text-sm font-normal text-white">(í˜„ì¬: ${wc.toFixed(2)})</span></h4>
                    <p class="text-sm text-gray-400 mt-1">T_c(ì—°ì† ì‹œê°„)ê°€ ì–¼ë§ˆë‚˜ í° ë³´ë„ˆìŠ¤ë¥¼ ì¤„ì§€ ê²°ì •í•˜ëŠ” ìƒìˆ˜ì…ë‹ˆë‹¤. ì´ ê°’ì´ 0ì´ë©´ T_cëŠ” ì•„ë¬´ ì˜ë¯¸ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
                    <p class="text-sm mt-1"><strong>AI í™œìš©ë²•:</strong> AIì—ê²Œ "ë‚˜ëŠ” [ì°½ì˜ì ì¸ ì‘ì—…]ì„ í•˜ê³  ìˆì–´. T_c ë³´ë„ˆìŠ¤ê°€ í°(w_c=0.5) ì‘ì—…ì´ë‹ˆ, 2ì‹œê°„ ë™ì•ˆ ë°©í•´ë°›ì§€ ì•Šë„ë¡ ë³´ì¡°í•´ì¤˜"ë¼ê³  ì„ ì–¸í•˜ë©° í•™ìŠµ í™˜ê²½ì„ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                </div>
            `;
        }
        
        // --- 3. ìœ í‹¸ë¦¬í‹° ë° ë©”ì¸ ì‹¤í–‰ ---

        function runFullSimulation() {
            try {
                const params_shared = {};
                paramIds_shared.forEach(id => {
                    params_shared[id] = parseFloat(inputs[id].value);
                });

                const params_A = { ...params_shared };
                paramIds_1.forEach(id => {
                    const genericKey = id.replace('_1', '');
                    params_A[genericKey] = parseFloat(inputs[id].value);
                });

                const params_B = { ...params_shared };
                paramIds_2.forEach(id => {
                    const genericKey = id.replace('_2', '');
                    params_B[genericKey] = parseFloat(inputs[id].value);
                });

                const k_value_A = calculateKDaily(params_A);
                const data_A = runSimulation(params_A, k_value_A);
                
                const k_value_B = calculateKDaily(params_B);
                const data_B = runSimulation(params_B, k_value_B);
                
                updateChart(data_A, data_B);
                updateAnalysis(data_A, data_B, params_shared, k_value_A, k_value_B);
                
                // [ë²„ê·¸ ìˆ˜ì •] ì˜¬ë°”ë¥¸ íŒŒë¼ë¯¸í„°ë¡œ í˜¸ì¶œ
                updateComparativeReport(data_A, data_B, params_A, params_B, k_value_A, k_value_B); 
                
                // [ë²„ê·¸ ìˆ˜ì •] ì´ì œ ì´ í•¨ìˆ˜ê°€ ì •ìƒì ìœ¼ë¡œ í˜¸ì¶œë¨
                updateVariableGuide(params_B, k_value_B); 

            } catch (error) {
                console.error("ì‹œë®¬ë ˆì´ì…˜ ì‹¤í–‰ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:", error);
                // ì˜¤ë¥˜ ë°œìƒ ì‹œ ì‚¬ìš©ìì—ê²Œ ì•Œë¦´ ìˆ˜ ìˆëŠ” UI ë¡œì§ ì¶”ê°€ (ì˜µì…˜)
            }
        }

        function updateSliderLabel(id, value) {
            if (values[id]) {
                const key = id.replace(/_1|_2$/, ''); 
                
                if (key === 'total_time' || key === 'continuous_time') {
                    values[id].textContent = `${value.toFixed(1)} ì‹œê°„`;
                } else if (key === 'focus_level') {
                    values[id].textContent = `${(value * 100).toFixed(0)} %`;
                } else if (key === 'B') {
                    values[id].textContent = value.toFixed(3);
                } else if (key === 'wc') {
                    values[id].textContent = value.toFixed(2);
                } else if (key === 'Sim_Days') {
                    values[id].textContent = `${value.toFixed(0)} ì¼`;
                } else { // A0, L
                    values[id].textContent = value.toFixed(0);
                }
            }
        }

        function updateSimDaysStep(currentValue) {
            const slider = inputs.Sim_Days;
            if (!slider) return;

            let newStep = 30;
            if (currentValue < 1825) newStep = 5;       
            else if (currentValue < 3650) newStep = 7;  
            else if (currentValue < 7300) newStep = 30; 
            else if (currentValue < 10950) newStep = 60;
            else if (currentValue < 14600) newStep = 90;
            else newStep = 120; 
            slider.step = newStep;
        }

        function initializeApp() {
            console.log("DOM ë¡œë“œ ì™„ë£Œ. v9 ì•± ì´ˆê¸°í™” ì‹œì‘...");
            
            allParamIds.forEach(id => {
                inputs[id] = document.getElementById(`param-${id}`);
                values[id] = document.getElementById(`val-${id}`);
                
                if (!inputs[id] || !values[id]) {
                    console.warn(`DOM ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: param-${id} ë˜ëŠ” val-${id}`);
                }
            });

            allParamIds.forEach(id => {
                if(inputs[id]) {
                    inputs[id].addEventListener('input', (event) => {
                        const value = parseFloat(event.target.value);
                        if (id === 'Sim_Days') {
                            updateSimDaysStep(value);
                        }
                        updateSliderLabel(id, value);
                        runFullSimulation(); 
                    });
                }
            });
            
            document.querySelectorAll('.accordion-button').forEach(button => {
                button.addEventListener('click', () => {
                    const content = button.nextElementSibling;
                    const icon = button.querySelector('svg');
                    const isOpening = content.style.display !== 'block';
                    document.querySelectorAll('.accordion-content').forEach(c => c.style.display = 'none');
                    document.querySelectorAll('.accordion-button svg').forEach(i => i.style.transform = 'rotate(0deg)');
                    if (isOpening) {
                        content.style.display = 'block';
                        icon.style.transform = 'rotate(180deg)';
                    }
                });
            });

            // ì´ˆê¸° ì‹¤í–‰
            runFullSimulation();
            console.log("ì•± ì´ˆê¸°í™” ì™„ë£Œ. (v9)");
        }
        
    </script>
</body>
</html>

